### ekf_filter_node_odom params (local odometry)
ekf_filter_node_odom:
  ros__parameters:
    frequency: 50.0
    sensor_timeout: 2.0  # Increased timeout to allow sensors to initialize and stabilize
    two_d_mode: false  # 3D for fixed-wing
    
    # Frame configuration
    map_frame: map
    odom_frame: odom
    base_link_frame: base_link_front
    world_frame: odom
    
    # Transform parameters
    publish_tf: true
    publish_acceleration: false

    initial_state: [0.0, 0.0, 5.0,    # x, y, z position
                    0.0, 0.0, 0.0,    # roll, pitch, yaw
                    0.0, 0.0, 0.0,    # vx, vy, vz
                    0.0, 0.0, 0.0,    # vroll, vpitch, vyaw
                    0.0, 0.0, 0.0]    # ax, ay, az
    
    # IMU configuration (from /imu_ekf topic)
    # IMU is REQUIRED for EKF to start publishing TF
    imu0: /imu_ekf
    imu0_config: [false, false, false,   # IMU does NOT provide position!
                  true,  true,  true,    # roll, pitch, yaw (orientation)
                  false, false, false,   # x_vel, y_vel, z_vel
                  false, false, true,    # roll_vel, pitch_vel, yaw_vel
                  false,  false,  false]    # x_accel, y_accel, z_accel
    imu0_differential: false
    imu0_relative: false
    imu0_queue_size: 10
    imu0_remove_gravitational_acceleration: true
    
    # Barometer configuration (converts pressure to altitude)
    # Barometer is optional - EKF can work without it
    pose0: /barometer/altitude  # After conversion to PoseWithCovarianceStamped
    pose0_config: [false, false, true,    # Only use Z position
                   false, false, false,
                   false, false, false,
                   false, false, false,
                   false, false, false]
    pose0_differential: false
    pose0_relative: false
    pose0_queue_size: 5
    
    # Gazebo ground truth odometry (PRIMARY - provides accurate X, Y, Z from Gazebo)
    # This is the main source for position since IMU odometry doesn't work for manual movement
    # NOTE: EKF can publish TF with just IMU, but position will be 0,0,5 until this arrives
    odom0: /gazebo/odom
    odom0_config: [true,  true,  true,    # Use X, Y, Z position from Gazebo (ground truth)
                   false, false, false,    # Don't use orientation (use IMU instead)
                   true,  true,  true,     # Use X, Y, Z velocities
                   false, false, false,
                   false, false, false]
    odom0_differential: false
    odom0_relative: false
    odom0_queue_size: 10
    odom0_pose_rejection_threshold: 100.0  # Very permissive for ground truth
    odom0_twist_rejection_threshold: 50.0
    
    # IMU-based odometry (SECONDARY - fallback if Gazebo pose not available)
    # Note: X/Y will be 0.0 if drone is moved manually (no physics acceleration)
    odom1: /marid/odom
    odom1_config: [false, false, true,    # Only use Z position from IMU (X/Y are unreliable)
                   true,  true,  true,    # Use orientation (will be refined by IMU)
                   false, false, true,    # Only use Z velocity
                   false, false, false,
                   false, false, false]
    odom1_differential: false
    odom1_relative: false
    odom1_queue_size: 10
    odom1_pose_rejection_threshold: 100.0
    odom1_twist_rejection_threshold: 50.0
    
    # Process noise covariance (tune these based on your sensor quality)
    # Order: x, y, z, roll, pitch, yaw, vx, vy, vz, vroll, vpitch, vyaw, ax, ay, az
    process_noise_covariance: [0.05, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.05, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.06, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.03, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.03, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.06, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.025, 0.0, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.025, 0.0, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.04, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.01, 0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.01, 0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.02, 0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.01, 0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.01, 0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.015]

### ekf_filter_node_map params (global positioning with GPS)
ekf_filter_node_map:
  ros__parameters:
    frequency: 30.0
    sensor_timeout: 2.0  # Increased timeout to allow sensors to initialize and stabilize
    two_d_mode: false
    
    # Frame configuration
    map_frame: map
    odom_frame: odom
    base_link_frame: base_link_front
    world_frame: map
    
    # Publish TF: map -> base_link_front
    # Local EKF publishes odom -> base_link_front (different parent frame, no conflict)
    publish_tf: true
    publish_acceleration: false
    
    # Odometry from local EKF
    odom0: /odometry/filtered/local
    odom0_config: [true,  true,  true,    # Use position from local EKF
                   true,  true,  true,    # Use orientation
                   true,  true,  true,    # Use velocities
                   false, false, false,
                   false, false, false]
    odom0_differential: false
    odom0_relative: false
    odom0_queue_size: 10
    
    # GPS configuration (assuming NavSatFix converted to Odometry)
    odom1: /gps/odometry  # After conversion with navsat_transform_node
    odom1_config: [true,  true,  false,   # Use GPS X, Y, but not Z
                   false, false, false,
                   false, false, false,
                   false, false, false,
                   false, false, false]
    odom1_differential: false
    odom1_relative: false
    odom1_queue_size: 10
    odom1_pose_rejection_threshold: 5.0  # Reject outliers
    odom1_twist_rejection_threshold: 1.0
    
    # Process noise (similar to local)
    process_noise_covariance: [0.5, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.5, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.06, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.03, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.03, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.06, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.025, 0.0, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.025, 0.0, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.04, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.01, 0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.01, 0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.02, 0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.01, 0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.01, 0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.015]