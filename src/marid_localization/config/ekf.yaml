### ekf_filter_node_odom params (local odometry)
ekf_filter_node_odom:
  ros__parameters:
    frequency: 50.0
    sensor_timeout: 2.0  # Increased timeout to allow sensors to initialize and stabilize
    two_d_mode: false  # 3D for fixed-wing
    
    # Frame configuration
    map_frame: map
    odom_frame: odom
    base_link_frame: base_link_front
    world_frame: odom
    
    # Transform parameters
    publish_tf: true
    publish_acceleration: false

    initial_state: [0.0, 0.0, 5.0,    # x, y, z position
                    0.0, 0.0, 0.0,    # roll, pitch, yaw
                    0.0, 0.0, 0.0,    # vx, vy, vz
                    0.0, 0.0, 0.0,    # vroll, vpitch, vyaw
                    0.0, 0.0, 0.0]    # ax, ay, az
    
    # IMU configuration (from /imu_ekf topic)
    # IMU is REQUIRED for EKF to start publishing TF
    imu0: /imu_ekf
    imu0_config: [false, false, false,   # IMU does NOT provide position!
                  true,  true,  true,    # roll, pitch, yaw (orientation)
                  false, false, false,   # x_vel, y_vel, z_vel
                  false, false, true,    # roll_vel, pitch_vel, yaw_vel
                  false,  false,  false]    # x_accel, y_accel, z_accel
    imu0_differential: false
    imu0_relative: false
    imu0_queue_size: 10
    imu0_remove_gravitational_acceleration: true
    # IMU sensor covariance (critical for filter stability)
    imu0_orientation_nom: 0.01  # Orientation noise (rad²) - low for good IMU
    imu0_angular_velocity_nom: 0.1  # Angular velocity noise (rad²/s²)
    
    # Barometer configuration (converts pressure to altitude)
    # Barometer is optional - EKF can work without it
    pose0: /barometer/altitude  # After conversion to PoseWithCovarianceStamped
    pose0_config: [false, false, true,    # Only use Z position
                   false, false, false,
                   false, false, false,
                   false, false, false,
                   false, false, false]
    pose0_differential: false
    pose0_relative: false
    pose0_queue_size: 5
    # Barometer sensor covariance
    pose0_pose_nom: 0.1  # Position noise (m²) - moderate for barometer altitude
    
    # Gazebo ground truth odometry (PRIMARY - provides accurate X, Y, Z from Gazebo)
    # This is the main source for position since IMU odometry doesn't work for manual movement
    # NOTE: EKF can publish TF with just IMU, but position will be 0,0,5 until this arrives
    odom0: /gazebo/odom
    odom0_config: [true,  true,  true,    # Use X, Y, Z position from Gazebo (ground truth)
                   false, false, false,    # Don't use orientation (use IMU instead)
                   true,  true,  true,     # Use X, Y, Z velocities
                   false, false, false,
                   false, false, false]
    odom0_differential: false
    odom0_relative: false
    odom0_queue_size: 10
    odom0_pose_rejection_threshold: 100.0  # Very permissive for ground truth
    odom0_twist_rejection_threshold: 50.0
    # Odometry sensor covariance (low for ground truth)
    odom0_pose_nom: 0.01  # Position noise (m²) - very low for ground truth
    odom0_twist_nom: 0.1  # Velocity noise (m²/s²) - low for ground truth
    
    # FAST-LIO LiDAR-Inertial Odometry (from 3D LIDAR + IMU)
    odom1: /Odometry  # FAST-LIO publishes to /Odometry topic
    odom1_config: [true,  true,  true,    # Use X, Y, Z position from LiDAR odometry
                   false, false, false,    # Don't use orientation (use IMU instead)
                   true,  true,  true,     # Use X, Y, Z velocities
                   false, false, false,
                   false, false, false]
    odom1_differential: false
    odom1_relative: false
    odom1_queue_size: 10
    odom1_pose_rejection_threshold: 10.0
    odom1_twist_rejection_threshold: 5.0
    # LiDAR odometry covariance (good accuracy, better than GPS)
    odom1_pose_nom: 0.05  # Position noise (m²) - good for LiDAR odometry
    odom1_twist_nom: 0.15  # Velocity noise (m²/s²)
    
    # Process noise covariance (tune these based on your sensor quality)
    # Order: x, y, z, roll, pitch, yaw, vx, vy, vz, vroll, vpitch, vyaw, ax, ay, az
    # Increased values slightly for better numerical stability
    process_noise_covariance: [0.1, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.1, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.1, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.05, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.05, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.1, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.05, 0.0, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.05, 0.0, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.08, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.02, 0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.02, 0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.04, 0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.02, 0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.02, 0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.03]

### ekf_filter_node_map params (global positioning with GPS)
ekf_filter_node_map:
  ros__parameters:
    frequency: 30.0
    sensor_timeout: 2.0  # Increased timeout to allow sensors to initialize and stabilize
    two_d_mode: false
    
    # Frame configuration
    map_frame: map
    odom_frame: odom
    base_link_frame: base_link_front
    world_frame: map
    
    # Publish TF: map -> base_link_front
    # Local EKF publishes odom -> base_link_front (different parent frame, no conflict)
    publish_tf: true
    publish_acceleration: false
    
    # Odometry from local EKF
    odom0: /odometry/filtered/local
    odom0_config: [true,  true,  true,    # Use position from local EKF
                   true,  true,  true,    # Use orientation
                   true,  true,  true,    # Use velocities
                   false, false, false,
                   false, false, false]
    odom0_differential: false
    odom0_relative: false
    odom0_queue_size: 10
    # Local EKF odometry covariance (from filtered output)
    odom0_pose_nom: 0.05  # Position noise (m²) - moderate for filtered odometry
    odom0_twist_nom: 0.1  # Velocity noise (m²/s²)
    
    # GPS configuration (assuming NavSatFix converted to Odometry)
    odom1: /gps/odometry  # After conversion with navsat_transform_node
    odom1_config: [true,  true,  false,   # Use GPS X, Y, but not Z
                   false, false, false,
                   false, false, false,
                   false, false, false,
                   false, false, false]
    odom1_differential: false
    odom1_relative: false
    odom1_queue_size: 10
    odom1_pose_rejection_threshold: 5.0  # Reject outliers
    odom1_twist_rejection_threshold: 1.0
    # GPS odometry covariance (higher noise for GPS)
    odom1_pose_nom: 1.0  # Position noise (m²) - higher for GPS
    
    # Process noise (similar to local, increased for stability)
    process_noise_covariance: [1.0, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  1.0, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.1, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.05, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.05, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.1, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.05, 0.0, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.05, 0.0, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.08, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.02, 0.0,  0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.02, 0.0,  0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.04, 0.0,  0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.02, 0.0,  0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.02, 0.0,
                               0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.03]